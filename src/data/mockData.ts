import { Product, RelatedProduct } from "@/types/product";
import { STORE_COORDINATES } from "./storeCoordinates";

// UK supermarket mock data
export const mockProducts: Record<string, Product[]> = {
  "milk": [
    {
      id: "1",
      name: "Whole Milk",
      brand: "Tesco Finest",
      size: "2L",
      category: "Dairy",
      averagePrice: 1.85,
      stores: [
        {
          id: "s1",
          storeName: "Tesco",
          price: 1.65,
          distance: 1.2,
          address: "123 High Street, London",
          latitude: STORE_COORDINATES.s1.lat,
          longitude: STORE_COORDINATES.s1.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 15,
          dealText: "Clubcard Price",
        },
        {
          id: "s2",
          storeName: "Sainsbury's",
          price: 1.75,
          distance: 2.0,
          address: "456 King's Road, London",
          latitude: STORE_COORDINATES.s2.lat,
          longitude: STORE_COORDINATES.s2.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
        {
          id: "s3",
          storeName: "Asda",
          price: 1.55,
          distance: 0.8,
          address: "789 Queen Street, London",
          latitude: STORE_COORDINATES.s3.lat,
          longitude: STORE_COORDINATES.s3.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 10,
        },
      ],
    },
    {
      id: "1b",
      name: "Semi-Skimmed Milk",
      brand: "Sainsbury's Organic",
      size: "1L",
      category: "Dairy",
      averagePrice: 1.45,
      stores: [
        {
          id: "s2",
          storeName: "Sainsbury's",
          price: 1.35,
          distance: 2.0,
          address: "456 King's Road, London",
          latitude: STORE_COORDINATES.s2.lat,
          longitude: STORE_COORDINATES.s2.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 10,
          dealText: "Nectar Offer",
        },
        {
          id: "s4",
          storeName: "Waitrose",
          price: 1.55,
          distance: 3.1,
          address: "321 Park Lane, London",
          latitude: STORE_COORDINATES.s4.lat,
          longitude: STORE_COORDINATES.s4.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
  "bread": [
    {
      id: "2",
      name: "Wholemeal Bread",
      brand: "Hovis",
      size: "800g",
      category: "Bakery",
      averagePrice: 1.20,
      stores: [
        {
          id: "s1",
          storeName: "Tesco",
          price: 1.00,
          distance: 1.2,
          address: "123 High Street, London",
          latitude: STORE_COORDINATES.s1.lat,
          longitude: STORE_COORDINATES.s1.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 20,
          dealText: "Meal Deal",
        },
        {
          id: "s3",
          storeName: "Asda",
          price: 1.10,
          distance: 0.8,
          address: "789 Queen Street, London",
          latitude: STORE_COORDINATES.s3.lat,
          longitude: STORE_COORDINATES.s3.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
    {
      id: "2b",
      name: "Seeded Batch Loaf",
      brand: "Waitrose",
      size: "600g",
      category: "Bakery",
      averagePrice: 1.75,
      stores: [
        {
          id: "s2",
          storeName: "Sainsbury's",
          price: 1.65,
          distance: 2.0,
          address: "456 King's Road, London",
          latitude: STORE_COORDINATES.s2.lat,
          longitude: STORE_COORDINATES.s2.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 10,
        },
        {
          id: "s4",
          storeName: "Waitrose",
          price: 1.85,
          distance: 3.1,
          address: "321 Park Lane, London",
          latitude: STORE_COORDINATES.s4.lat,
          longitude: STORE_COORDINATES.s4.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
  "eggs": [
    {
      id: "3",
      name: "Free Range Eggs",
      brand: "Happy Egg Co",
      size: "12 pack",
      category: "Dairy",
      averagePrice: 3.50,
      stores: [
        {
          id: "s3",
          storeName: "Asda",
          price: 3.20,
          distance: 0.8,
          address: "789 Queen Street, London",
          latitude: STORE_COORDINATES.s3.lat,
          longitude: STORE_COORDINATES.s3.lon,
          inStock: true,
          lastUpdated: new Date(),
          dealText: "Rollback Price",
        },
        {
          id: "s1",
          storeName: "Tesco",
          price: 3.40,
          distance: 1.2,
          address: "123 High Street, London",
          latitude: STORE_COORDINATES.s1.lat,
          longitude: STORE_COORDINATES.s1.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
    {
      id: "3b",
      name: "Free Range Eggs",
      brand: "Clarence Court",
      size: "6 pack",
      category: "Dairy",
      averagePrice: 2.25,
      stores: [
        {
          id: "s1",
          storeName: "Tesco",
          price: 2.10,
          distance: 1.2,
          address: "123 High Street, London",
          latitude: STORE_COORDINATES.s1.lat,
          longitude: STORE_COORDINATES.s1.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 10,
        },
        {
          id: "s2",
          storeName: "Sainsbury's",
          price: 2.30,
          distance: 2.0,
          address: "456 King's Road, London",
          latitude: STORE_COORDINATES.s2.lat,
          longitude: STORE_COORDINATES.s2.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
  "chicken": [
    {
      id: "4",
      name: "Chicken Breast Fillets",
      brand: "Tesco",
      size: "600g",
      category: "Meat & Poultry",
      averagePrice: 4.50,
      stores: [
        {
          id: "s1",
          storeName: "Tesco",
          price: 4.00,
          distance: 1.2,
          address: "123 High Street, London",
          latitude: STORE_COORDINATES.s1.lat,
          longitude: STORE_COORDINATES.s1.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 15,
          dealText: "Clubcard Price",
        },
        {
          id: "s3",
          storeName: "Asda",
          price: 4.50,
          distance: 0.8,
          address: "789 Queen Street, London",
          latitude: STORE_COORDINATES.s3.lat,
          longitude: STORE_COORDINATES.s3.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
  "rice": [
    {
      id: "5",
      name: "Basmati Rice",
      brand: "Tilda",
      size: "1kg",
      category: "Rice & Pasta",
      averagePrice: 2.50,
      stores: [
        {
          id: "s2",
          storeName: "Sainsbury's",
          price: 2.30,
          distance: 2.0,
          address: "456 King's Road, London",
          latitude: STORE_COORDINATES.s2.lat,
          longitude: STORE_COORDINATES.s2.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 10,
        },
        {
          id: "s3",
          storeName: "Asda",
          price: 2.40,
          distance: 0.8,
          address: "789 Queen Street, London",
          latitude: STORE_COORDINATES.s3.lat,
          longitude: STORE_COORDINATES.s3.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
  "pasta": [
    {
      id: "6",
      name: "Spaghetti",
      brand: "Barilla",
      size: "500g",
      category: "Rice & Pasta",
      averagePrice: 1.20,
      stores: [
        {
          id: "s1",
          storeName: "Tesco",
          price: 1.00,
          distance: 1.2,
          address: "123 High Street, London",
          latitude: STORE_COORDINATES.s1.lat,
          longitude: STORE_COORDINATES.s1.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 20,
        },
        {
          id: "s4",
          storeName: "Waitrose",
          price: 1.35,
          distance: 3.1,
          address: "321 Park Lane, London",
          latitude: STORE_COORDINATES.s4.lat,
          longitude: STORE_COORDINATES.s4.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
  "cheese": [
    {
      id: "7",
      name: "Mature Cheddar",
      brand: "Cathedral City",
      size: "350g",
      category: "Dairy",
      averagePrice: 3.00,
      stores: [
        {
          id: "s3",
          storeName: "Asda",
          price: 2.75,
          distance: 0.8,
          address: "789 Queen Street, London",
          latitude: STORE_COORDINATES.s3.lat,
          longitude: STORE_COORDINATES.s3.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 10,
        },
        {
          id: "s2",
          storeName: "Sainsbury's",
          price: 3.00,
          distance: 2.0,
          address: "456 King's Road, London",
          latitude: STORE_COORDINATES.s2.lat,
          longitude: STORE_COORDINATES.s2.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
  "tomatoes": [
    {
      id: "8",
      name: "Cherry Tomatoes",
      brand: "Tesco",
      size: "250g",
      category: "Fresh Produce",
      averagePrice: 1.50,
      stores: [
        {
          id: "s1",
          storeName: "Tesco",
          price: 1.30,
          distance: 1.2,
          address: "123 High Street, London",
          latitude: STORE_COORDINATES.s1.lat,
          longitude: STORE_COORDINATES.s1.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 15,
        },
        {
          id: "s2",
          storeName: "Sainsbury's",
          price: 1.60,
          distance: 2.0,
          address: "456 King's Road, London",
          latitude: STORE_COORDINATES.s2.lat,
          longitude: STORE_COORDINATES.s2.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
  "bananas": [
    {
      id: "9",
      name: "Bananas",
      brand: "Fyffes",
      size: "6 pack",
      category: "Fresh Produce",
      averagePrice: 0.95,
      stores: [
        {
          id: "s3",
          storeName: "Asda",
          price: 0.85,
          distance: 0.8,
          address: "789 Queen Street, London",
          latitude: STORE_COORDINATES.s3.lat,
          longitude: STORE_COORDINATES.s3.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
        {
          id: "s1",
          storeName: "Tesco",
          price: 0.90,
          distance: 1.2,
          address: "123 High Street, London",
          latitude: STORE_COORDINATES.s1.lat,
          longitude: STORE_COORDINATES.s1.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
  "apples": [
    {
      id: "10",
      name: "Gala Apples",
      brand: "Pink Lady",
      size: "6 pack",
      category: "Fresh Produce",
      averagePrice: 2.20,
      stores: [
        {
          id: "s2",
          storeName: "Sainsbury's",
          price: 2.00,
          distance: 2.0,
          address: "456 King's Road, London",
          latitude: STORE_COORDINATES.s2.lat,
          longitude: STORE_COORDINATES.s2.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 10,
        },
        {
          id: "s1",
          storeName: "Tesco",
          price: 2.20,
          distance: 1.2,
          address: "123 High Street, London",
          latitude: STORE_COORDINATES.s1.lat,
          longitude: STORE_COORDINATES.s1.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
  "potatoes": [
    {
      id: "11",
      name: "White Potatoes",
      brand: "Maris Piper",
      size: "2kg",
      category: "Fresh Produce",
      averagePrice: 1.50,
      stores: [
        {
          id: "s3",
          storeName: "Asda",
          price: 1.30,
          distance: 0.8,
          address: "789 Queen Street, London",
          latitude: STORE_COORDINATES.s3.lat,
          longitude: STORE_COORDINATES.s3.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 15,
        },
        {
          id: "s1",
          storeName: "Tesco",
          price: 1.50,
          distance: 1.2,
          address: "123 High Street, London",
          latitude: STORE_COORDINATES.s1.lat,
          longitude: STORE_COORDINATES.s1.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
  "carrots": [
    {
      id: "12",
      name: "Carrots",
      brand: "Tesco",
      size: "1kg",
      category: "Fresh Produce",
      averagePrice: 0.70,
      stores: [
        {
          id: "s1",
          storeName: "Tesco",
          price: 0.60,
          distance: 1.2,
          address: "123 High Street, London",
          latitude: STORE_COORDINATES.s1.lat,
          longitude: STORE_COORDINATES.s1.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 10,
        },
        {
          id: "s3",
          storeName: "Asda",
          price: 0.65,
          distance: 0.8,
          address: "789 Queen Street, London",
          latitude: STORE_COORDINATES.s3.lat,
          longitude: STORE_COORDINATES.s3.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
  "onions": [
    {
      id: "13",
      name: "Brown Onions",
      brand: "Tesco",
      size: "1kg",
      category: "Fresh Produce",
      averagePrice: 0.85,
      stores: [
        {
          id: "s3",
          storeName: "Asda",
          price: 0.75,
          distance: 0.8,
          address: "789 Queen Street, London",
          latitude: STORE_COORDINATES.s3.lat,
          longitude: STORE_COORDINATES.s3.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
        {
          id: "s2",
          storeName: "Sainsbury's",
          price: 0.90,
          distance: 2.0,
          address: "456 King's Road, London",
          latitude: STORE_COORDINATES.s2.lat,
          longitude: STORE_COORDINATES.s2.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
  "yogurt": [
    {
      id: "14",
      name: "Natural Yogurt",
      brand: "Rachel's Organic",
      size: "450g",
      category: "Dairy",
      averagePrice: 2.00,
      stores: [
        {
          id: "s4",
          storeName: "Waitrose",
          price: 1.85,
          distance: 3.1,
          address: "321 Park Lane, London",
          latitude: STORE_COORDINATES.s4.lat,
          longitude: STORE_COORDINATES.s4.lon,
          inStock: true,
          lastUpdated: new Date(),
          discount: 10,
        },
        {
          id: "s2",
          storeName: "Sainsbury's",
          price: 2.00,
          distance: 2.0,
          address: "456 King's Road, London",
          latitude: STORE_COORDINATES.s2.lat,
          longitude: STORE_COORDINATES.s2.lon,
          inStock: true,
          lastUpdated: new Date(),
        },
      ],
    },
  ],
};

export const relatedProductsMap: Record<string, RelatedProduct[]> = {
  "milk": [
    { id: "r1", name: "Greek Yoghurt", category: "Dairy", lowestPrice: 2.50 },
    { id: "r2", name: "Butter", category: "Dairy", lowestPrice: 1.85 },
    { id: "r3", name: "Cream", category: "Dairy", lowestPrice: 1.50 },
    { id: "r4", name: "Oat Milk", category: "Dairy Alternatives", lowestPrice: 1.80 },
  ],
  "bread": [
    { id: "r5", name: "Bagels", category: "Bakery", lowestPrice: 1.20 },
    { id: "r6", name: "Crumpets", category: "Bakery", lowestPrice: 0.95 },
    { id: "r7", name: "Pitta Bread", category: "Bakery", lowestPrice: 0.85 },
    { id: "r8", name: "Croissants", category: "Bakery", lowestPrice: 1.50 },
  ],
  "eggs": [
    { id: "r9", name: "Organic Eggs", category: "Dairy", lowestPrice: 3.50 },
    { id: "r10", name: "Bacon", category: "Meat", lowestPrice: 2.50 },
    { id: "r11", name: "Sausages", category: "Meat", lowestPrice: 2.00 },
  ],
  "chicken": [
    { id: "r12", name: "Chicken Thighs", category: "Meat & Poultry", lowestPrice: 3.50 },
    { id: "r13", name: "Turkey Mince", category: "Meat & Poultry", lowestPrice: 3.00 },
  ],
  "rice": [
    { id: "r14", name: "Jasmine Rice", category: "Rice & Pasta", lowestPrice: 2.80 },
    { id: "r15", name: "Brown Rice", category: "Rice & Pasta", lowestPrice: 2.20 },
  ],
  "pasta": [
    { id: "r16", name: "Penne", category: "Rice & Pasta", lowestPrice: 1.00 },
    { id: "r17", name: "Pasta Sauce", category: "Cooking Ingredients", lowestPrice: 0.95 },
  ],
  "cheese": [
    { id: "r18", name: "Mozzarella", category: "Dairy", lowestPrice: 1.80 },
    { id: "r19", name: "Parmesan", category: "Dairy", lowestPrice: 2.50 },
  ],
  "tomatoes": [
    { id: "r20", name: "Cucumbers", category: "Fresh Produce", lowestPrice: 0.70 },
    { id: "r21", name: "Lettuce", category: "Fresh Produce", lowestPrice: 0.85 },
  ],
  "bananas": [
    { id: "r22", name: "Apples", category: "Fresh Produce", lowestPrice: 1.50 },
    { id: "r23", name: "Oranges", category: "Fresh Produce", lowestPrice: 1.20 },
  ],
  "apples": [
    { id: "r24", name: "Bananas", category: "Fresh Produce", lowestPrice: 0.85 },
    { id: "r25", name: "Oranges", category: "Fresh Produce", lowestPrice: 1.20 },
  ],
  "potatoes": [
    { id: "r26", name: "Carrots", category: "Fresh Produce", lowestPrice: 0.60 },
    { id: "r27", name: "Onions", category: "Fresh Produce", lowestPrice: 0.75 },
  ],
  "carrots": [
    { id: "r28", name: "Potatoes", category: "Fresh Produce", lowestPrice: 1.30 },
    { id: "r29", name: "Onions", category: "Fresh Produce", lowestPrice: 0.75 },
  ],
  "onions": [
    { id: "r30", name: "Garlic", category: "Fresh Produce", lowestPrice: 0.80 },
    { id: "r31", name: "Potatoes", category: "Fresh Produce", lowestPrice: 1.30 },
  ],
  "yogurt": [
    { id: "r32", name: "Greek Yogurt", category: "Dairy", lowestPrice: 2.50 },
    { id: "r33", name: "Milk", category: "Dairy", lowestPrice: 1.55 },
  ],
};

export function searchProduct(query: string): Product[] | null {
  const normalizedQuery = query.toLowerCase().trim();
  
  // First try exact match
  if (mockProducts[normalizedQuery]) {
    return mockProducts[normalizedQuery];
  }
  
  // Try with 's' added or removed for plural/singular matching
  const singularQuery = normalizedQuery.endsWith('s') 
    ? normalizedQuery.slice(0, -1) 
    : normalizedQuery + 's';
  
  if (mockProducts[singularQuery]) {
    return mockProducts[singularQuery];
  }
  
  // Try partial match - find if query is contained in any product key
  const partialMatch = Object.keys(mockProducts).find(key => 
    key.includes(normalizedQuery) || normalizedQuery.includes(key)
  );
  
  if (partialMatch) {
    return mockProducts[partialMatch];
  }
  
  return null;
}

export function getRelatedProducts(query: string): RelatedProduct[] {
  const normalizedQuery = query.toLowerCase().trim();
  return relatedProductsMap[normalizedQuery] || [];
}
